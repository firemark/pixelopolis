<!doctype html>
<html lang="en-us">

<head>
  <script src="pixelopolis.js"></script>
  <script>
    Module.buildAndDraw = _ => {
      const code = document.getElementById('code').innerText;
      Module.func__build(code);
      Module.func__draw(0, 0, 0);
      setTimeout(Module.buildAndDraw, 3000);
    };

    Module.onRuntimeInitialized = _ => {
      Module['canvas'] = document.getElementById('canvas');
      Module.func__init = Module.cwrap('init', 'number', []);
      Module.func__stop = Module.cwrap('stop', 'number', []);
      Module.func__build = Module.cwrap('build', 'number', ['string']);
      Module.func__draw = Module.cwrap('draw', 'number', ['number', 'number', 'number']);

      Module.func__init();
      Module.buildAndDraw();
      // stop();
    };
  </script>
</head>

<body>
  <code id="code" style="display: none;">
world {
    width: 800;
    height: 800;
    body: cube.example;
}

cube.example {
	wall: wall.grey-brick;
  roof: wall.top;
  width: random(350, 600);
  depth: random(350, 400);
  height: 150;
}

wall.grey-brick { texture: h-tex.grey-brick; }
wall.top { texture: tex.wood; }

h-tex.grey-brick {
    background: tex.grey-brick;
    center: v-tex.windows;
    width: 100%;
    justify: center;
}

v-tex.windows {
    center: tex.window;
    justify: end;
    padding: 20;
    height: 40;
}

tex.wood        { color: #F00; }
tex.grey-brick  { color: #AAA; }
tex.window      { color: #000; width: 32; height: 32; }
</code>
<canvas id="canvas"></canvas>
</body>

</html>